<!DOCTYPE html>
<html>
	<head>
		<title>Flare Dota Model Viewer</title>
		
		<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css" rel="stylesheet">
		<link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.4/slate/bootstrap.min.css" rel="stylesheet">
		<link href="bootstrapXL.css" rel="stylesheet">
		
		<link href='http://fonts.googleapis.com/css?family=Montserrat' rel='stylesheet' type='text/css'>
		
		<style>
			body
			{
				background: #040404 url(Black_Texture___Ray_by_Ethenyl.jpg) right center no-repeat;
				margin-bottom: 10px;
			}
			.navbar {
				margin-bottom: 0;
			}
			#canvasdiv
			{
				overflow: hidden;
				height: 640px;
				border-bottom: 3px solid #000;
				text-align: center;
			}
			canvas.emscripten { 
				border: 0px none; 
				margin: 0 auto;
			}
			#control
			{
				padding-top: 15px;
			}
			#control h1
			{
				margin-top: 0;
				font-size: 60px;
				font-family: 'Montserrat', sans-serif;
			}
			#control h2
			{
				font-size: 18px;
				font-family: 'Montserrat', sans-serif;
				color: #555;
			}
			#control h2 b
			{
				color: rgb(200, 200, 200);
			}
			
			@media (min-width: 1600px) {
				#canvasdiv
				{
					text-align: left;
				}
				#control
				{
					text-align: right;
				}
			}
		</style>
		
		<script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
		<script src="bootstrap3-typeahead.min.js"></script>
	</head>
	<body>
		<nav class="navbar navbar-default">
			<div class="container">
				<div class="navbar-header">
					<a class="navbar-brand" href="#">
						Flare
					</a>
				</div>
				<div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
					<ul class="nav navbar-nav">
						<li class="active"><a href="#">Link 1</a></li>
						<li><a href="#">Link 2</a></li>
					</ul>
					<p class="navbar-text" id="status">Working...</p>
				</div>
			</div>
		</nav>
		<div class="container" id="content">
			<div class="row">
				<div class="col-lg-12 col-xl-8 col-xl-push-4" id="canvasdiv">
					<canvas class="emscripten" id="canvas" oncontextmenu="event.preventDefault()"></canvas>
				</div>
				<div class="col-lg-12 col-xl-4 col-xl-pull-8" id="control">
					<div class="row">
						<div class="col-lg-4 col-xl-12">
							<!--  <h1>Ancient Apparition</h1>
							<h2><b>Kaldr</b> the <b>Ancient Apparition</b></h2> -->
							<h1>Axe</h1>
							<h2><b>Mogul Khan,</b> the <b>Axe</b></h2>
						</div>
						<div class="visible-xl-block col-xl-12">
							<hr />
						</div>
						<div class="col-lg-8 col-xl-12" id="equipmentlist">
							Equipment list goes here
							<br />
							<br />
							<h3>Current models</h3>
							<ul id="modellist">
								<!-- <li>- <span class="remover" data-remove="-1">[X]</span></li> -->
							</ul>
							<br />
							<input class="form-control"  type="text" id="modelname" placeholder="models/heroes/<something> (Try bounty)" autocomplete="off" />
							<br /><input type=button id="addmodelbtn" class="btn btn-primary" value="Add Model" />
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<!-- Flare engine starter -->
		<script type='text/javascript'>
			var statusElement = document.getElementById('status');
			//var progressElement = document.getElementById('progress');

			var Module = {
				preRun: [],
				postRun: function() {
					console.log("Preparing Browser-side UI");
					prepareUI();
				},
				print: (function() {
					var element = document.getElementById('output');
					if (element) element.value = ''; // clear browser cache
					return function(text) {
						if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
						// These replacements are necessary if you render to raw HTML
						//text = text.replace(/&/g, "&amp;");
						//text = text.replace(/</g, "&lt;");
						//text = text.replace(/>/g, "&gt;");
						//text = text.replace('\n', '<br>', 'g');
						console.log(text);
						if (element) {
							element.value += text + "\n";
							element.scrollTop = element.scrollHeight; // focus on bottom
						}
					};
				})(),
				printErr: function(text) {
					if (arguments.length > 1) text = Array.prototype.slice.call(arguments).join(' ');
					if (0) { // XXX disabled for safety typeof dump == 'function') {
						dump(text + '\n'); // fast, straight to the real console
					} else {
						console.error(text);
					}
				},
				canvas: (function() {
					var canvas = document.getElementById('canvas');

					// As a default initial behavior, pop up an alert when webgl context is lost. To make your
					// application robust, you may want to override this behavior before shipping!
					// See http://www.khronos.org/registry/webgl/specs/latest/1.0/#5.15.2
					canvas.addEventListener("webglcontextlost", function(e) { alert('WebGL context lost. You will need to reload the page.'); e.preventDefault(); }, false);

					return canvas;
				})(),
				setStatus: function(text) {
					if (!Module.setStatus.last) Module.setStatus.last = { time: Date.now(), text: '' };
					if (text === Module.setStatus.text) return;
					var m = text.match(/([^(]+)\((\d+(\.\d+)?)\/(\d+)\)/);
					var now = Date.now();
					if (m && now - Date.now() < 30) return; // if this is a progress update, skip it if too soon
					if (m) {
						text = m[1];
						//progressElement.value = parseInt(m[2])*100;
						//progressElement.max = parseInt(m[4])*100;
						//progressElement.hidden = false;
						//spinnerElement.hidden = false;
					} else {
						//progressElement.value = null;
						//progressElement.max = null;
						//progressElement.hidden = true;
						//if (!text) spinnerElement.style.display = 'none';
					}
					statusElement.innerHTML = text;
				},
				totalDependencies: 0,
				monitorRunDependencies: function(left) {
					this.totalDependencies = Math.max(this.totalDependencies, left);
					Module.setStatus(left ? 'Starting... (' + (this.totalDependencies-left) + '/' + this.totalDependencies + ')' : 'All downloads complete.');
				}
			};
			Module.setStatus('Loading Engine...');
			window.onerror = function(event) {
				// TODO: do not warn on ok events like simulating an infinite loop or exitStatus
				Module.setStatus('JavaScript error, open console for more details (Ctrl-Shift-J)');
				//spinnerElement.style.display = 'none';
				Module.setStatus = function(text) {
					if (text) Module.printErr('[post-exception status] ' + text);
				};
			};
			
			// Flare Engine UI
			function removeModel()
			{
				var v = parseInt($(this).attr('data-remove'));
				console.log("Removing "+v);
				Module.MC_RemoveModel(Module.MC_GetModel(v));
				refreshList();
			}
			
			function refreshList()
			{
				var count = Module.MC_ModelCount();
				$("#modellist").html("");
				for(var v=0;v<count;v++)
				{
					var $li = $("<li></li>");
					$li.append($("<span></span>").text(Module.MC_GetModel(v) + " "));
					$li.append($("<span></span>").text("[X]").attr('data-remove',v).click(removeModel));
					$("#modellist").append($li);
				}
			}
			
			function addModel()
			{
				Module.MC_AddModel($('#modelname').val());	
				$('#modelname').val("");
				refreshList();
			}

			function prepareUI()
			{
				//$("#equipmentlist").html("");
				setInterval(refreshList,3000);
				$("#addmodelbtn").click(addModel);
				
				$('#modelname').typeahead({ 
					source:[
						"models/heroes/bane/bane.vmdl_c",
						
						"models/heroes/bounty_hunter/bounty_hunter.vmdl_c",
						"models/heroes/bounty_hunter/bounty_hunter_backpack.vmdl_c",
						"models/heroes/bounty_hunter/bounty_hunter_bandana.vmdl_c",
						"models/heroes/bounty_hunter/bounty_hunter_bweapon.vmdl_c",
						"models/heroes/bounty_hunter/bounty_hunter_lweapon.vmdl_c",
						"models/heroes/bounty_hunter/bounty_hunter_rweapon.vmdl_c",
						"models/heroes/bounty_hunter/bounty_hunter_pads.vmdl_c",
						"models/heroes/bounty_hunter/bounty_hunter_shuriken.vmdl_c",
						
						"models/heroes/axe/axe.vmdl_c",
						"models/heroes/axe/axe_armor.vmdl_c",
						"models/heroes/axe/axe_belt.vmdl_c",
						"models/heroes/axe/axe_ponytail.vmdl_c",
						"models/heroes/axe/axe_weapon.vmdl_c",
						
						"models/items/axe/guillotine_weapon/guillotine_weapon.vmdl_c",
						"models/items/axe/axe_practos_weapon/axe_practos_weapon.vmdl_c",
						"models/items/axe/corruptor/corruptor.vmdl_c",
						
						"models/heroes/ogre_magi/ogre_magi.vmdl_c",
						"models/heroes/ogre_magi/ogre_magi_belt.vmdl_c",
						"models/heroes/ogre_magi/ogre_magi_bracers.vmdl_c",
						"models/heroes/ogre_magi/ogre_magi_cape.vmdl_c",
						"models/heroes/ogre_magi/ogre_magi_hats.vmdl_c",
						"models/heroes/ogre_magi/ogre_magi_weapon.vmdl_c",
						
						"models/courier/baby_rosh/babyroshan.vmdl_c",
						"models/items/courier/bearzky/bearzky.vmdl_c",
						"models/items/courier/bearzky/bearzky_flying.vmdl_c",
					],
					afterSelect: addModel,
					autoSelect: false,
				});
			};
			
		</script>
		<script async type="text/javascript" src="raw.js"></script>
		
		<script>
			(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
			(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
			m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
			})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
			
			ga('create', 'UA-63784515-1', 'auto');
			ga('send', 'pageview');
		</script>
	</body>
</html>